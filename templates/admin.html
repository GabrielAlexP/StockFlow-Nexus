<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Vendas - Gesso Aparecida</title>
    <link rel="stylesheet" href="../static/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <!-- Barra de Cabe√ßalho -->
    <header>
        <h1>Dashboard Vendas</h1>
        <div class="icon-container">
            <div class="left-icons">
                <div class="icon icon-expand" id="menu-icon"><i class="fa fa-bars"></i></div>
                <div class="icon icon-fill" id="home-icon"><i class="fa fa-home"></i></div>
                <div class="icon icon-enter"><i class="fa fa-user"></i></div>
            </div>
            <div class="right-icons">
                <div class="toggle-container">
                    <label for="status-toggle" class="toggle-label">Vendas</label>
                    <input type="checkbox" id="status-toggle" class="toggle" />
                    <label for="status-toggle" class="toggle-label">Or√ßamentos</label>
                </div>
                <div class="icon icon-collapse" id="exit-icon"><i class="fa fa-sign-in"></i></div>
            </div>
        </div>
    </header>

    <!-- NAV BAR -->
    <nav id="sidebar">
        <ul class="nav-superior">
            <li><a href="#" id="estoqueLink">üì¶ Estoque</a></li>
            <li><a href="#" id="vendasLink">üõí Vendas</a></li>
        </ul>
        <ul class="nav-inferior">
            <li id="opcoesEstoque"></li>
            <li id="opcoesVendas"></li>
        </ul>
    </nav>

    <!-- Cont√™iner para Sele√ß√µes -->
    <div class="filtros">
        <!-- Sele√ß√£o de Empresas -->
        <div class="filtro">
            <label for="empresa">Empresa:</label>
            <select name="" id="empresa-select">
                <option value=""></option>
            </select>
        </div>

        <!-- Sele√ß√£o de Vendedores -->
        <div class="vendedor-selecao">
            <label for="vendedor-selecao">Vendedor:</label>
            <select id="vendedor-selecao">
                <option value="Total">Total</option>
            </select>
        </div>

        <!-- Sele√ß√£o de Meses -->
        <div class="selecao-mes">
            <label for="mes">M√™s:</label>
            <select id="mes" class="input-mes">
                <option value="janeiro">Janeiro</option>
                <option value="fevereiro">Fevereiro</option>
                <option value="mar√ßo">Mar√ßo</option>
                <option value="abril">Abril</option>
                <option value="maio">Maio</option>
                <option value="junho">Junho</option>
                <option value="julho">Julho</option>
                <option value="agosto">Agosto</option>
                <option value="setembro">Setembro</option>
                <option value="outubro">Outubro</option>
                <option value="novembro">Novembro</option>
                <option value="dezembro">Dezembro</option>
            </select>
        </div>

        <!-- Sele√ß√£o de Ano -->
        <div class="selecao-ano">
            <label for="ano">Ano:</label>
            <input type="number" id="ano" class="input-ano" value="2025" min="2000" max="2099">
        </div>
    </div>

    <!-- Caixa de Dados de Desempenho -->
    <div class="caixas-dados">
        <div class="caixa">
            <h3>N√∫mero de Or√ßamentos</h3>
            <p id="orcamentos">0</p>
        </div>
        <div class="caixa">
            <h3>Venda Total</h3>
            <p id="vendas-total">0</p>
        </div>
        <div class="caixa">
            <h3>Total Lucro</h3>
            <p id="lucro-total">0</p>
        </div>
        <div class="caixa">
            <h3>Comiss√£o</h3>
            <p id="comissao">0</p>
        </div>
    </div>

    <!-- √Årea Principal -->
    <div class="area-principal">
        <!-- Se√ß√£o Esquerda -->
        <div class="left-page">
            <!-- Gr√°fico de Rosca e Select de Metas -->
            <div class="area-metas">
                <!-- Gr√°fico de Rosca -->
                <div class="grafico-rosca">
                    <canvas id="grafico-rosca"></canvas>
                </div>
                <div class="lado-grafico">
                    <!-- Select de Metas -->
                    <div class="meta-horizontal">
                        <select id="metas" class="metas-select">
                            <option value="mensal">Meta Mensal</option>
                            <option value="trimestral">Meta Trimestral</option>
                            <option value="semestral">Meta Semestral</option>
                        </select>
                        <select id="personalizado" class="metas-select" style="display: none;"></select>
                    </div>
                    <!-- Mensagem da Meta -->
                    <p id="valor-meta" class="mensagem-meta">Sua meta este m√™s √© Z</p>
                    <p id="mensagem-meta" class="mensagem-meta">Falta X para alcan√ßar a meta</p>
                    <p id="mensagem-venda" class="mensagem-venda">Voc√™ j√° vendeu Y</p>
                </div>
            </div>
        </div>

        <!-- Barra Vertical -->
        <div class="barra-vertical"></div>

        <!-- Se√ß√£o Direita -->
        <div class="right-page">
            <!-- √Årea de Busca -->
            <div class="area-busca">
                <label for="busca-pedido">Pedido:</label>
                <input type="text" id="busca-pedido" class="input-busca">
                <button id="buscar-pedido" class="botao-busca">Buscar</button>
            </div>

            <!-- Tabela de Pedidos -->
            <div class="tabela-pedidos">
                <table>
                    <thead>
                        <tr>
                            <th>Pedido</th>
                            <th>Cliente</th>
                            <th>Valor</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-corpo">
                        <!-- Linhas de pedidos ser√£o inseridas aqui -->
                    </tbody>
                </table>
            </div>

            <!-- Tabela de Produtos -->
            <div class="tabela-produtos">
                <table>
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descri√ß√£o</th>
                            <th>Qtd</th>
                            <th>Valor Unit√°rio</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="produtos-corpo">
                        <!-- Linhas de produtos ser√£o inseridas aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Gr√°fico de Barras -->
    <div class="grafico-principal">
        <canvas id="grafico-barras"></canvas>
    </div>

    <!-- Scripts para Gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Recupera os dados do usu√°rio armazenados
            const usuarioData = sessionStorage.getItem("usuario");

            if (usuarioData) {
                const usuario = JSON.parse(usuarioData);
            } else {
                console.warn("Nenhum dado de usu√°rio encontrado.");
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const menuIcon = document.getElementById("menu-icon");
            const nav = document.querySelector("nav");

            menuIcon.addEventListener("click", function () {
                nav.classList.toggle("active"); // Abre/fecha o menu ao clicar
            });

            // Fecha o menu se clicar fora dele
            document.addEventListener("click", function (event) {
                if (!nav.contains(event.target) && !menuIcon.contains(event.target)) {
                    nav.classList.remove("active");
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            const opcoesEstoque = document.getElementById('opcoesEstoque');
            const opcoesVendas = document.getElementById('opcoesVendas');
            const usuario = JSON.parse(sessionStorage.getItem("usuario"));

            function verificarPermissaoEstoque() {
                if (!usuario) {
                    alert('Usu√°rio n√£o autenticado!');
                    return false;
                }
                const cargoNormalizado = usuario.Cargo.trim().toLowerCase();
                const cargosPermitidos = ['admin', 'estoque'];

                if (!cargosPermitidos.includes(cargoNormalizado)) {
                    alert('Voc√™ n√£o tem permiss√£o para acessar esta p√°gina!');
                    return false;
                }
                return true;
            }

            function verificarPermissaoVendas() {
                if (!usuario) {
                    alert('Usu√°rio n√£o autenticado!');
                    return false;
                }
                const cargoNormalizado = usuario.Cargo.trim().toLowerCase();
                const cargosPermitidosVendas = ['admin', 'vendedor', 'gerente', 'supervisor'];

                if (!cargosPermitidosVendas.includes(cargoNormalizado)) {
                    alert('Voc√™ n√£o tem permiss√£o para acessar esta p√°gina!');
                    return false;
                }
                return true;
            }

            function adicionarLinks(lista, links, verificarPermissao, outraLista) {
                outraLista.innerHTML = '';
                lista.innerHTML = '';
                if (!verificarPermissao()) return;

                // Adiciona o t√≠tulo da navega√ß√£o
                lista.innerHTML = `<li class="nav-title">${lista.getAttribute("id").replace('opcoes', 'Op√ß√µes de ')}</li>`;

                links.forEach(link => {
                    // Se for o link /fiscal, s√≥ adiciona se o usu√°rio for admin
                    if (link.url === '/fiscal') {
                        if (usuario.Cargo.trim().toLowerCase() !== 'admin') {
                            return; // N√£o adiciona o link para usu√°rios que n√£o s√£o admin
                        }
                    }

                    const li = document.createElement('li');
                    li.innerHTML = `<a href="${link.url}">${link.icone} ${link.texto}</a>`;
                    li.querySelector('a').addEventListener('click', function (e) {
                        if (!verificarPermissao()) {
                            e.preventDefault();
                            lista.innerHTML = '';
                        }
                    });
                    lista.appendChild(li);
                });
            }

            document.getElementById('estoqueLink').addEventListener('click', function (e) {
                e.preventDefault();
                adicionarLinks(opcoesEstoque, [
                    { url: '/estoque', texto: 'Consulta de Estoque', icone: 'üì¶' },
                    { url: '/pedidos', texto: 'Status de Pedido', icone: 'üîÑ' },
                    { url: '/fiscal', texto: 'Perfil Fiscal V2', icone: 'üìã' },
                ], verificarPermissaoEstoque, opcoesVendas);
            });

            document.getElementById('vendasLink').addEventListener('click', function (e) {
                e.preventDefault();
                adicionarLinks(opcoesVendas, [
                    { url: '/ranking', texto: 'Ranking de Vendas', icone: 'üìä' },
                    { url: '/cnpj', texto: 'Consulta de CNPJ', icone: 'üîé' }
                ], verificarPermissaoVendas, opcoesEstoque);
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            // Recupera os dados do usu√°rio armazenados
            const usuarioData = sessionStorage.getItem("usuario");
            console.log(usuarioData);
            if (!usuarioData) {
                alert("Usu√°rio n√£o autenticado! Redirecionando para a p√°gina de login...");
                window.location.href = "/"; // Ajuste a URL conforme necess√°rio
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const homeIcon = document.getElementById("home-icon");
            const exitIcon = document.getElementById("exit-icon");

            // Redirecionamento para /portal ao clicar no √≠cone de home
            homeIcon.addEventListener("click", function () {
                window.location.href = "/portal";
            });

            // Redirecionamento para / e limpeza do sessionStorage ao clicar no √≠cone de sa√≠da
            exitIcon.addEventListener("click", function () {
                sessionStorage.clear(); // Remove todas as informa√ß√µes do sessionStorage
                window.location.href = "/"; // Redireciona para a p√°gina inicial
            });
        });

        async function carregarEmpresas() {
            try {
                const response = await fetch('/api/empresas');
                if (!response.ok) throw new Error('Erro ao carregar empresas');
                const empresas = await response.json();
                const select = document.getElementById('empresa-select');
                select.innerHTML = '';

                empresas.forEach(empresa => {
                    const option = document.createElement('option');
                    option.value = empresa.IDEmpresa;
                    option.textContent = `${empresa.IDEmpresa}`;
                    select.appendChild(option);
                });
            } catch (error) {
                alert('Erro ao carregar a lista de empresas.');
            }
        }
        document.addEventListener('DOMContentLoaded', carregarEmpresas);

        document.getElementById('empresa-select').addEventListener('change', async function () {
            const empresaId = this.value;
            if (!empresaId) return;

            try {
                const response = await fetch(`/api/vendedores?empresa_id=${empresaId}`);
                if (!response.ok) throw new Error('Erro ao carregar vendedores');

                const vendedores = await response.json();
                const selectVendedor = document.getElementById('vendedor-selecao');
                selectVendedor.innerHTML = '<option value="Total">Total</option>'; // Resetando as op√ß√µes

                vendedores.forEach(vendedor => {
                    const option = document.createElement('option');
                    option.value = vendedor.ID_VENDEDOR;
                    option.textContent = vendedor.LogON;
                    selectVendedor.appendChild(option);
                });
            } catch (error) {
                alert('Erro ao carregar a lista de vendedores.');
            }
        });

        async function carregarVendasTotal() {
            const empresaId = document.getElementById('empresa-select').value;
            const vendedorSelect = document.getElementById('vendedor-selecao');
            const vendedorId = vendedorSelect.value;
            // Se o checkbox estiver marcado, assumimos que o status √© "O" (Or√ßamentos);
            // caso contr√°rio, "V" (Vendas)
            const statusToggle = document.getElementById('status-toggle');
            const status = statusToggle.checked ? 'S' : 'V';
            const ano = document.getElementById('ano').value;
            const mes = document.getElementById('mes').value;

            if (!empresaId) return;

            try {
                const response = await fetch(`/api/vendas_total?empresa_id=${empresaId}&vendedor_id=${vendedorId}&status=${status}&ano=${ano}&mes=${mes}`);
                if (!response.ok) throw new Error('Erro ao carregar total de vendas');
                const data = await response.json();
                document.getElementById('vendas-total').textContent = data.total;
                document.getElementById('vendas-total').textContent =
                    Number(data.total).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            } catch (error) {
                alert('Erro ao carregar o total de vendas.');
            }
        }

        // Voc√™ pode chamar essa fun√ß√£o sempre que algum filtro for alterado, por exemplo:
        document.getElementById('empresa-select').addEventListener('change', carregarVendasTotal);
        document.getElementById('vendedor-selecao').addEventListener('change', carregarVendasTotal);
        document.getElementById('status-toggle').addEventListener('change', carregarVendasTotal);
        document.getElementById('ano').addEventListener('change', carregarVendasTotal);
        document.getElementById('mes').addEventListener('change', carregarVendasTotal);

        async function carregarVendasDetalhes() {
            const empresaId = document.getElementById('empresa-select').value;
            const vendedorSelect = document.getElementById('vendedor-selecao');
            const vendedorId = vendedorSelect.value;
            // Se o checkbox estiver marcado, consideramos o status 'S' para Or√ßamentos; caso contr√°rio, 'V' para Vendas.
            const statusToggle = document.getElementById('status-toggle');
            const status = statusToggle.checked ? 'S' : 'V';
            const ano = document.getElementById('ano').value;
            const mes = document.getElementById('mes').value;

            if (!empresaId) return;

            try {
                const response = await fetch(`/api/vendas_detalhes?empresa_id=${empresaId}&vendedor_id=${vendedorId}&status=${status}&ano=${ano}&mes=${mes}`);
                if (!response.ok) throw new Error('Erro ao carregar os detalhes de vendas');
                const data = await response.json();

                // Atualiza o n√∫mero de or√ßamentos
                document.getElementById('orcamentos').textContent = data.qtd_orcamentos;
                // Atualiza a comiss√£o total formatada
                document.getElementById('comissao').textContent = Number(data.total_commissao).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                // Atualiza o lucro total formatado
                document.getElementById('lucro-total').textContent = Number(data.lucro_total).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            } catch (error) {
                alert('Erro ao carregar os detalhes de vendas.');
            }
        }


        // Adiciona a chamada dessa fun√ß√£o quando os filtros s√£o alterados:
        document.getElementById('empresa-select').addEventListener('change', carregarVendasDetalhes);
        document.getElementById('vendedor-selecao').addEventListener('change', carregarVendasDetalhes);
        document.getElementById('status-toggle').addEventListener('change', carregarVendasDetalhes);
        document.getElementById('ano').addEventListener('change', carregarVendasDetalhes);
        document.getElementById('mes').addEventListener('change', carregarVendasDetalhes);

        document.addEventListener("DOMContentLoaded", function () {
            async function carregarGraficoVendas() {
                const empresaId = document.getElementById('empresa-select').value;
                const vendedorId = document.getElementById('vendedor-selecao').value;
                const status = document.getElementById('status-toggle').checked ? 'S' : 'V';
                const ano = document.getElementById('ano').value;
                const mes = document.getElementById('mes').value;

                if (!empresaId) return;

                try {
                    const response = await fetch(`/api/grafico_vendas?empresa_id=${empresaId}&vendedor_id=${vendedorId}&status=${status}&ano=${ano}&mes=${mes}`);
                    if (!response.ok) throw new Error('Erro ao carregar gr√°fico de vendas');
                    const data = await response.json();

                    const labels = Object.keys(data);
                    const valores = Object.values(data);

                    const ctx = document.getElementById('grafico-barras').getContext('2d');
                    if (window.graficoBarras) {
                        window.graficoBarras.destroy();
                    }
                    window.graficoBarras = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Vendas por Dia',
                                data: valores,
                                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1,
                                barPercentage: 0.7,
                                categoryPercentage: 0.7,
                                hitRadius: 10,
                                hoverBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            devicePixelRatio: 2,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                x: {
                                    ticks: {
                                        autoSkip: false, // Exibe todos os r√≥tulos
                                        maxRotation: 0,
                                        minRotation: 0,
                                        font: {
                                            size: 12
                                        },
                                        padding: 5
                                    }
                                },
                                y: {
                                    beginAtZero: true
                                }
                            },
                            plugins: {
                                tooltip: {
                                    bodyFont: {
                                        size: 12
                                    }
                                },
                                legend: {
                                    display: true,
                                    labels: {
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            },
                            hover: {
                                mode: 'nearest',
                                intersect: false
                            }
                        }
                    });
                } catch (error) {
                    alert(error.message);
                }
            }

            document.getElementById('empresa-select').addEventListener('change', carregarGraficoVendas);
            document.getElementById('vendedor-selecao').addEventListener('change', carregarGraficoVendas);
            document.getElementById('status-toggle').addEventListener('change', carregarGraficoVendas);
            document.getElementById('ano').addEventListener('change', carregarGraficoVendas);
            document.getElementById('mes').addEventListener('change', carregarGraficoVendas);

            carregarGraficoVendas();
        });

        document.addEventListener("DOMContentLoaded", function () {
            async function carregarMeta() {
                const empresaId = document.getElementById('empresa-select').value;
                const vendedorId = document.getElementById('vendedor-selecao').value;
                if (!empresaId) return;

                try {
                    // Chama a API de meta independentemente do vendedor ser "Total" ou n√£o
                    const metaResponse = await fetch(`/api/meta?empresa_id=${empresaId}&vendedor_id=${vendedorId}`);
                    if (!metaResponse.ok) throw new Error('Erro ao carregar meta');
                    const metaData = await metaResponse.json();
                    const meta = parseFloat(metaData.Meta) || 0;

                    // Busca o total de vendas
                    const ano = document.getElementById('ano').value;
                    const mes = document.getElementById('mes').value;
                    const status = document.getElementById('status-toggle').checked ? 'S' : 'V';
                    const vendaResponse = await fetch(`/api/vendas_total?empresa_id=${empresaId}&vendedor_id=${vendedorId}&status=${status}&ano=${ano}&mes=${mes}`);
                    if (!vendaResponse.ok) throw new Error('Erro ao carregar total de vendas');
                    const vendaData = await vendaResponse.json();
                    const vendaTotal = parseFloat(vendaData.total) || 0;

                    const falta = meta - vendaTotal;

                    // Atualiza os textos com os valores calculados
                    document.getElementById('valor-meta').textContent = `Sua meta este m√™s √© ${meta.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
                    document.getElementById('mensagem-meta').textContent = `Falta ${falta.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} para alcan√ßar a meta`;
                    document.getElementById('mensagem-venda').textContent = `Voc√™ j√° vendeu ${vendaTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;

                    if (vendaTotal >= meta) {
                        document.getElementById('mensagem-meta').textContent = "Parab√©ns, voc√™ bateu a meta!";
                    } else {
                        document.getElementById('mensagem-meta').textContent = `Falta ${falta.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} para alcan√ßar a meta`;
                    }

                    document.getElementById('mensagem-venda').textContent = `Voc√™ j√° vendeu ${vendaTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
                    // Renderiza o gr√°fico de rosca
                    const ctxRosca = document.getElementById('grafico-rosca').getContext('2d');
                    if (window.graficoRosca) {
                        window.graficoRosca.destroy();
                    }
                    const achieved = Math.min(vendaTotal, meta); // se as vendas excederem a meta, consideramos no m√°ximo a meta
                    const missing = meta - achieved;
                    window.graficoRosca = new Chart(ctxRosca, {
                        type: 'doughnut',
                        data: {
                            labels: ['Batido', 'Falta'],
                            datasets: [{
                                data: [achieved, missing],
                                backgroundColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 99, 132, 1)'],
                                hoverBackgroundColor: ['rgba(54, 162, 235, 0.8)', 'rgba(255, 99, 132, 0.8)']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error(error);
                    alert(error.message);
                }
            }

            // Registra os event listeners necess√°rios para atualizar a meta e o gr√°fico
            document.getElementById('empresa-select').addEventListener('change', carregarMeta);
            document.getElementById('vendedor-selecao').addEventListener('change', carregarMeta);
            document.getElementById('status-toggle').addEventListener('change', carregarMeta);
            document.getElementById('ano').addEventListener('change', carregarMeta);
            document.getElementById('mes').addEventListener('change', carregarMeta);

            carregarMeta();
        });

        async function buscarPedido() {
            const pedidoInput = document.getElementById('busca-pedido').value.trim();
            const empresaId = document.getElementById('empresa-select').value;
            if (!pedidoInput || !empresaId) {
                alert("Preencha o n√∫mero do pedido e selecione a empresa.");
                return;
            }
            try {
                const response = await fetch(`/api/buscar_pedido?pedido=${pedidoInput}&empresa_id=${empresaId}`);
                if (!response.ok) throw new Error("Erro ao buscar pedido");
                const data = await response.json();

                // Atualiza a tabela de pedidos
                const tbodyPedido = document.getElementById('tabela-corpo');
                tbodyPedido.innerHTML = "";
                if (data.order && Object.keys(data.order).length > 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>${data.order.PEDIDO}</td>
                <td>${data.order.NomeCliente}</td>
                <td>${Number(data.order.Valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                <td>${data.order.DataVenda}</td>
            `;
                    tbodyPedido.appendChild(tr);
                } else {
                    tbodyPedido.innerHTML = "<tr><td colspan='4'>Nenhum pedido encontrado.</td></tr>";
                }

                // Atualiza a tabela de produtos
                const tbodyProdutos = document.getElementById('produtos-corpo');
                tbodyProdutos.innerHTML = "";
                if (data.products && data.products.length > 0) {
                    data.products.forEach(product => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                    <td>${product.IDProduto}</td>
                    <td>${product.Descri√ß√£o}</td>
                    <td>${product.Quantidade}</td>
                    <td>${Number(product.Valor).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                    <td>${Number(product.Total).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td>
                `;
                        tbodyProdutos.appendChild(tr);
                    });
                } else {
                    tbodyProdutos.innerHTML = "<tr><td colspan='5'>Nenhum produto encontrado.</td></tr>";
                }
            } catch (error) {
                alert(error.message);
            }
        }

        // Evento para o bot√£o de busca
        document.getElementById('buscar-pedido').addEventListener('click', buscarPedido);
        // Permite buscar pressionando Enter no campo de input
        document.getElementById('busca-pedido').addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                buscarPedido();
            }
        });
    </script>
</body>

</html>