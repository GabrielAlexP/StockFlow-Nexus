<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Vendas - Gerente</title>
    <link rel="stylesheet" href="../static/css/gerente.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <!-- Barra de Cabe√ßalho -->
    <header>
        <h1>Dashboard Vendas</h1>
        <div class="icon-container">
            <div class="left-icons">
                <div class="icon icon-expand" id="menu-icon"><i class="fa fa-bars"></i></div>
                <div class="icon icon-fill" id="home-icon"><i class="fa fa-home"></i></div>
                <div class="icon icon-enter"><i class="fa fa-user"></i></div>
            </div>
            <div class="right-icons">
                <div class="toggle-container">
                    <label for="status-toggle" class="toggle-label">Vendas</label>
                    <input type="checkbox" id="status-toggle" class="toggle" />
                    <label for="status-toggle" class="toggle-label">Or√ßamentos</label>
                </div>
                <div class="icon icon-collapse" id="exit-icon"><i class="fa fa-sign-in"></i></div>
            </div>
        </div>
    </header>

    <!-- NAV BAR -->
    <nav id="sidebar">
        <ul class="nav-superior">
            <li><a href="#" id="estoqueLink">üì¶ Estoque</a></li>
            <li><a href="#" id="vendasLink">üõí Vendas</a></li>
        </ul>
        <ul class="nav-inferior">
            <li id="opcoesEstoque"></li>
            <li id="opcoesVendas"></li>
        </ul>
    </nav>

    <!-- Cont√™iner para Sele√ß√µes -->
    <div class="filtros">
        <!-- Sele√ß√£o de Vendedores -->
        <div class="vendedor-selecao">
            <label for="vendedor-selecao">Vendedor:</label>
            <select id="vendedor-selecao">
                <option value="Total">Total</option>
            </select>
        </div>

        <!-- Sele√ß√£o de Meses -->
        <div class="selecao-mes">
            <label for="mes">M√™s:</label>
            <select id="mes" class="input-mes">
                <option value="hoje">Hoje</option>
                <option value="janeiro">Janeiro</option>
                <option value="fevereiro">Fevereiro</option>
                <option value="mar√ßo">Mar√ßo</option>
                <option value="abril">Abril</option>
                <option value="maio">Maio</option>
                <option value="junho">Junho</option>
                <option value="julho">Julho</option>
                <option value="agosto">Agosto</option>
                <option value="setembro">Setembro</option>
                <option value="outubro">Outubro</option>
                <option value="novembro">Novembro</option>
                <option value="dezembro">Dezembro</option>
            </select>
        </div>

        <!-- Sele√ß√£o de Ano -->
        <div class="selecao-ano">
            <label for="ano">Ano:</label>
            <input type="number" id="ano" class="input-ano" value="2025" min="2000" max="2099">
        </div>
    </div>

    <!-- Caixa de Dados de Desempenho -->
    <div class="caixas-dados">
        <div class="caixa">
            <h3>N√∫mero de Or√ßamentos</h3>
            <p id="orcamentos">0</p>
        </div>
        <div class="caixa">
            <h3>Venda Total</h3>
            <p id="vendas-total">0</p>
        </div>
        <div class="caixa">
            <h3>Total Lucro</h3>
            <p id="lucro-total">0</p>
        </div>
        <div class="caixa">
            <h3>Meta</h3>
            <p id="meta">0</p>
        </div>
    </div>

    <!-- √Årea Principal -->
    <div class="area-principal">
        <!-- Se√ß√£o Esquerda -->
        <div class="left-page">
            <div class="area-metas">
                <div class="grafico-rosca">
                    <canvas id="grafico-rosca"></canvas>
                </div>
                <div class="lado-grafico">
                    <!-- Select de Metas -->
                    <div class="meta-horizontal">
                        <select id="metas" class="metas-select">
                            <option value="diaria" id="meta-diaria">Meta Di√°ria</option>
                            <option value="mensal">Meta Mensal</option>
                            <option value="trimestral">Meta Trimestral</option>
                            <option value="semestral">Meta Semestral</option>
                        </select>
                        <select id="personalizado" class="metas-select" style="display: none;"></select>
                    </div>
                    <!-- Mensagem da Meta -->
                    <p id="mensagem-meta" class="mensagem-meta">Falta X para alcan√ßar a meta</p>
                    <p id="mensagem-venda" class="mensagem-venda">Voc√™ j√° vendeu Y</p>
                </div>
            </div>
        </div>

        <!-- Barra Vertical -->
        <div class="barra-vertical"></div>

        <!-- Se√ß√£o Direita -->
        <div class="right-page">
            <div class="area-busca">
                <label for="busca-pedido">Pedido:</label>
                <input type="text" id="busca-pedido" class="input-busca">
                <button id="buscar-pedido" class="botao-busca">Buscar</button>
            </div>

            <div class="tabela-pedidos">
                <table>
                    <thead>
                        <tr>
                            <th>Pedido</th>
                            <th>Cliente</th>
                            <th>Valor</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-corpo">
                        <!-- Linhas de pedidos ser√£o inseridas aqui -->
                    </tbody>
                </table>
            </div>

            <div class="tabela-produtos">
                <table>
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descri√ß√£o</th>
                            <th>Qtd</th>
                            <th>Valor Unit√°rio</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="produtos-corpo">
                        <!-- Linhas de produtos ser√£o inseridas aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="grafico-principal">
        <canvas id="grafico-barras"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Recupera os dados do usu√°rio armazenados
            const usuarioData = sessionStorage.getItem("usuario");

            if (usuarioData) {
                const usuario = JSON.parse(usuarioData);
            } else {
                console.warn("Nenhum dado de usu√°rio encontrado.");
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const menuIcon = document.getElementById("menu-icon");
            const nav = document.querySelector("nav");

            menuIcon.addEventListener("click", function () {
                nav.classList.toggle("active"); // Abre/fecha o menu ao clicar
            });

            // Fecha o menu se clicar fora dele
            document.addEventListener("click", function (event) {
                if (!nav.contains(event.target) && !menuIcon.contains(event.target)) {
                    nav.classList.remove("active");
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            const opcoesEstoque = document.getElementById('opcoesEstoque');
            const opcoesVendas = document.getElementById('opcoesVendas');
            const usuario = JSON.parse(sessionStorage.getItem("usuario"));

            function verificarPermissaoEstoque() {
                if (!usuario) {
                    alert('Usu√°rio n√£o autenticado!');
                    return false;
                }
                const cargoNormalizado = usuario.Cargo.trim().toLowerCase();
                const cargosPermitidos = ['admin', 'estoque'];

                if (!cargosPermitidos.includes(cargoNormalizado)) {
                    alert('Voc√™ n√£o tem permiss√£o para acessar esta p√°gina!');
                    return false;
                }
                return true;
            }

            function verificarPermissaoVendas() {
                if (!usuario) {
                    alert('Usu√°rio n√£o autenticado!');
                    return false;
                }
                const cargoNormalizado = usuario.Cargo.trim().toLowerCase();
                const cargosPermitidosVendas = ['admin', 'vendedor', 'gerente', 'supervisor'];

                if (!cargosPermitidosVendas.includes(cargoNormalizado)) {
                    alert('Voc√™ n√£o tem permiss√£o para acessar esta p√°gina!');
                    return false;
                }
                return true;
            }

            function adicionarLinks(lista, links, verificarPermissao, outraLista) {
                outraLista.innerHTML = '';
                lista.innerHTML = '';
                if (!verificarPermissao()) return;

                // Adiciona o t√≠tulo da navega√ß√£o
                lista.innerHTML = `<li class="nav-title">${lista.getAttribute("id").replace('opcoes', 'Op√ß√µes de ')}</li>`;

                links.forEach(link => {
                    // Se for o link /fiscal, s√≥ adiciona se o usu√°rio for admin
                    if (link.url === '/fiscal') {
                        if (usuario.Cargo.trim().toLowerCase() !== 'admin') {
                            return; // N√£o adiciona o link para usu√°rios que n√£o s√£o admin
                        }
                    }

                    const li = document.createElement('li');
                    li.innerHTML = `<a href="${link.url}">${link.icone} ${link.texto}</a>`;
                    li.querySelector('a').addEventListener('click', function (e) {
                        if (!verificarPermissao()) {
                            e.preventDefault();
                            lista.innerHTML = '';
                        }
                    });
                    lista.appendChild(li);
                });
            }

            document.getElementById('estoqueLink').addEventListener('click', function (e) {
                e.preventDefault();
                adicionarLinks(opcoesEstoque, [
                    { url: '/estoque', texto: 'Consulta de Estoque', icone: 'üì¶' },
                    { url: '/pedidos', texto: 'Status de Pedido', icone: 'üîÑ' },
                    { url: '/fiscal', texto: 'Perfil Fiscal V2', icone: 'üìã' },
                ], verificarPermissaoEstoque, opcoesVendas);
            });

            document.getElementById('vendasLink').addEventListener('click', function (e) {
                e.preventDefault();
                adicionarLinks(opcoesVendas, [
                    { url: '/ranking', texto: 'Ranking de Vendas', icone: 'üìä' },
                    { url: '/cnpj', texto: 'Consulta de CNPJ', icone: 'üîé' }
                ], verificarPermissaoVendas, opcoesEstoque);
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            // Recupera os dados do usu√°rio armazenados
            const usuarioData = sessionStorage.getItem("usuario");

            if (!usuarioData) {
                alert("Usu√°rio n√£o autenticado! Redirecionando para a p√°gina de login...");
                window.location.href = "/"; // Ajuste a URL conforme necess√°rio
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const homeIcon = document.getElementById("home-icon");
            const exitIcon = document.getElementById("exit-icon");

            // Redirecionamento para /portal ao clicar no √≠cone de home
            homeIcon.addEventListener("click", function () {
                window.location.href = "/portal";
            });

            // Redirecionamento para / e limpeza do sessionStorage ao clicar no √≠cone de sa√≠da
            exitIcon.addEventListener("click", function () {
                sessionStorage.clear(); // Remove todas as informa√ß√µes do sessionStorage
                window.location.href = "/"; // Redireciona para a p√°gina inicial
            });
        });
    </script>
</body>

</html>